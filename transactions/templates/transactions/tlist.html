{% extends 'masterp.html' %}

{% load humanize %}

{% block title %}
       Transactions
{% endblock %}

{% block page_content %}

{% if page_obj %}

       <div class="btn-group">
              <button type="button" class="btn btn-secondary dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false">
                     date
              </button>
              <ul class="dropdown-menu">
                <li><a class="dropdown-item" href="{% url 'tlist' acc cat gcat pay 'tdate' gnull %}">a-z</a></li>
                <li><a class="dropdown-item" href="{% url 'tlist' acc cat gcat pay '-tdate' gnull %}">z-a</a></li>
              </ul>
              <button type="button" class="btn btn-secondary dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false">
                     payee
              </button>
              <ul class="dropdown-menu">
                     <li><a class="dropdown-item" href="{% url 'tlist' acc cat gcat pay 'payee' gnull %}">a-z</a></li>
                     <li><a class="dropdown-item" href="{% url 'tlist' acc cat gcat pay '-payee' gnull %}">z-a</a></li>
              </ul>
              <button type="button" class="btn btn-secondary dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false">
                     amount
              </button>
              <ul class="dropdown-menu">
                     <li><a class="dropdown-item" href="{% url 'tlist' acc cat gcat pay 'amount' gnull %}">a-z</a></li>
                     <li><a class="dropdown-item" href="{% url 'tlist' acc cat gcat pay '-amount' gnull %}">z-a</a></li>
              </ul>
              <button type="button" class="btn btn-secondary dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false">
                     category
              </button>
              <ul class="dropdown-menu">
                     <li><a class="dropdown-item" href="{% url 'tlist' acc cat gcat pay 'category' gnull %}">a-z</a></li>
                     <li><a class="dropdown-item" href="{% url 'tlist' acc cat gcat pay '-category' gnull %}">z-a</a></li>
              </ul>
		<button type="button" class="btn btn-secondary dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false">
                     show grouped
              </button>
              <ul class="dropdown-menu">
                     <li><a class="dropdown-item" href="{% url 'tlist' acc cat gcat pay ord 'n' %}">yes</a></li>
                     <li><a class="dropdown-item" href="{% url 'tlist' acc cat gcat pay ord 'y' %}">no</a></li>
              </ul>
       </div>

       <h1>Transactions</h1>
	<h2>{{ listCnt }}</h2>

       <table class="table table-dark">
              
              <thead>
                     <th scope="col">Date</th>
                     <th scope="col">Account</th>
                     <th scope="col">Payee</th>
                     <th scope="col">Old Cat</th>
                     <th scope="col">Category</th>
                     <th scope="col">Amount</th>
                     {% comment %}
                     <th scope="col">Sum</th>
                     {% endcomment %}
              </thead>

              {% for t in page_obj %}

              <tr>
                     <td>
                            <a href="{{ t.get_edit_url }}?next={{ request.path|urlencode }}?page={{ page_obj.number|urlencode }}">{{ t.tdate }}</a>
                     <td>   
                            <a href="{% url 'tlist'  t.account.id 'all' 'all' 'all' %}"> {{ t.account }}</a>
                     </td>
                     <td>
				<a href="{% url 'tlist' 'all' 'all' 'all' t.payee.id 'payee' 'n' %}"> {{ t.payee }}</a>
				<br>
				<a href="{% url 'payee-detail' t.payee.id %}?next={{ request.path|urlencode }}?page={{ page_obj.number|urlencode }}&dcat={{ t.category.id }}">edit</a>
				<br>
				<a href='https://www.google.com/search?q={{ t.payee }}' target='_blank'>info</a>
			</td>
                     <td>
                          {{ t.note }}
                     </td>

                     <td>

                            {% for st in t.get_subtrans_children %}
                                <p>{{ st.category }} | {{ st.groupedcat }} | {{ st.amount }} </p>
                            {% endfor %}
                     </td>

                     <td>{{ t.amount|floatformat:"2g" }} | {{ t.get_transaction_total }} </td>

                     {% comment %}
                     <td>{{ t.cumsum|floatformat:"2g" }}</td>
                     {% endcomment %}

                     <td><a hx-post="{{ t.get_delete_url }}" hx-confirm="delete item?" hx-trigger='click' href="{{ t.get_delete_url }}?next={{ request.path|urlencode }}?page={{ page_obj.number|urlencode }}">del</a></td>
              </tr>

              {% endfor %}

       </table>

{% else %}

	<p>No transactions yet.</p>

{% endif %}

{% endblock %}i